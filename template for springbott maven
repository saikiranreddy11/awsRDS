module "ecs_service_prism" {
  source = "terraform-aws-modules/ecs/aws//modules/service"

  # General Service Configuration
  name        = "prism"
  cluster_arn = "arn:aws:ecs:us-east-1:XXXXXXXXXXXX:cluster/PrismECSStack-cluster"

  # Deployment Configuration
  deployment_circuit_breaker = {
    enable   = false
    rollback = false
  }
  deployment_maximum_percent         = 200
  deployment_minimum_healthy_percent = 50
  desired_count                      = 1
  enable_execute_command             = true
  health_check_grace_period_seconds  = 60
  launch_type                        = "FARGATE"
  scheduling_strategy                = "REPLICA"
  platform_version                   = "LATEST"

  # Load Balancer Configuration
  load_balancer = [{
    container_name   = "gatewaydev-nginx-1"
    container_port   = 80
    target_group_arn = "arn:aws:elasticloadbalancing:us-east-1:XXXXXXXXXXXX:targetgroup/PrismE-AppLo-5B958PVJSU1/0cfaeab4c81e226"
  }]

  # Networking Configuration
  network_configuration = {
    assign_public_ip = false
    security_groups  = [
      "${data.terraform_remote_state.sg.outputs.aws_security_group_tfer--PrismECSStack-ECSS..."
    ]
    subnets = [
      "${data.terraform_remote_state.subnet.outputs.aws_subnet_tfer--subnet-0077e0e6819863838_id}",
      "${data.terraform_remote_state.subnet.outputs.aws_subnet_tfer--subnet-07093fb4c02523d76_id}"
    ]
  }

  # Service Discovery (Cloud Map)
  service_registries = [{
    container_port = 0
    port           = 0
    registry_arn   = "arn:aws:servicediscovery:us-east-1:XXXXXXXXXXXX:service/srv-15752uwfaqulowr"
  }]

  # Task Definition Reference
  task_definition = "arn:aws:ecs:us-east-1:XXXXXXXXXXXX:task-definition/PrismECSStackPrismTaskDefB05CB749:27"

  # Tags
  tags = {
    Environment = "production"
    Application = "prism"
  }
}
